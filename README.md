# linux-troubleshooting

http://www.brendangregg.com

![image](https://user-images.githubusercontent.com/45504115/136681720-791b58b7-0eec-4642-a0a5-37486b2dc70b.png)


### uptime
```
13:18:46 up 1 min,  1 user,  load average: 2.99, 0.97, 0.34
```

* 서버가 시작한 지 얼마나 되는지를 확인하기 위한 명령어
* 뒷부분에 있는 load average는 앞에서부터 1분, 5분, 15분간의 평균값. 이값은 0에 가까우면 좋고, 멀수록 좋지않다.
* 1분 평균이 5분이나 15분 평균보다 높으면 아직도 문제가 지속되고 있다는 의미
* load : https://en.wikipedia.org/wiki/Load_(computing)

### dmesg | tail
* dmesg 명령은 시스템 메세지를 확인하는 명령어. tail을 사용했기 때문에 최근 시스템메시지를 확인할 수 있다.

### vmstat 1
```
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  1      0 4607960 209244 1530872    0    0   910   513  248  381  3  6 81  9  0
 1  0      0 4599120 213024 1535740    0    0  4416     0 2301 4854  0  7 72 20  0
 0  1      0 4590260 217340 1540232    0    0  4832     0 2387 4024  0  8 72 19  0
 1  1      0 4582048 221932 1543864    0    0  5088   112 3034 5386  1  8 71 20  0
 1  0      0 4572304 227600 1548340    0    0  6308   648 3791 6257  0 14 67 19  0
 0  1      0 4555968 235316 1556696    0    0  8740     0 4888 8762  0 16 67 16  0
 1  1      0 4575656 242984 1559772    0    0  8052   484 3030 5137  6 13 62 19  0
 2  0      0 4552728 250900 1563540    0    0  8432     0 1929 4478 22  7 51 20  0
 1  1      0 4526024 258996 1569096    0    0  8700   428 2150 5785 23  9 49 19  0
 2  1      0 4514100 265484 1573944    0    0  7256     0 1769 4778 24  7 50 20  0
 1  1      0 4503760 271060 1578860    0    0  6088     0 1908 5645 24  6 50 19  0
 2  0      0 4490228 278824 1585752    0    0  8524     0 2305 4701 24 10 48 19  0
 2  0      0 4457480 281232 1615028    0    0  7111     0 1767 5851 23 24 49  4  0
 1  1      0 4439148 284220 1631456    0    0  7858 18800 2864 6564 22 18 46 14  0
 2  1      0 4431312 289268 1634856    0    0  5432     0 2568 4675 25 10 47 17  0
 1  1      0 4414316 294504 1641280    0    0  5876     0 3238 5686 22 14 46 18  0
```

* vmstat 명령은 가상 메모리의 상황을 확인하는 도구.
* r
  * CPU의 Run Queue를 의미하며, CPU가 바빠서 자기 차례를 기다리는 프로세스의 개수를 뜻함.
  * CPU코어 개수보다 이 숫자가 많으면 서버가 아주 바쁜 상황이라고 판단할 수 있음.
* free
  * KB단위의 메모리 여유를 의미. 가용 메모리가 많은지 확인해 봐야 한다.
* swap
  * 메모리가 부족할 때 디스크를 메모리처럼 사용하는 영역(가상메모리). 해당 영역은 반드시 사용하지 않고 있어야만 한다고 생각해야 하는것이 좋다.
  * si=swap in, so=swap out
* cpu
  * us(user CPU)
    * 사용자 애플리케이션(non-kernel code)에 의해 사용되는 CPU 시간 비율
  * sy(system CPU)
    * 시스템(kernel code)에 의해 사용되는 CPU 시간 비율
  * wa(wait I/O CPU)
    * CPU 사용 대기 시간 비율
